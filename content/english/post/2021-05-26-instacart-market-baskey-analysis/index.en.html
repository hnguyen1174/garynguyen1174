---
title: "Instacart Market Baskey Analysis \U0001F6D2"
summary: In this project, I predict next purchases from Instacart's customer purchases data using XGBoost.
author: Gary Nguyen
date: '2021-05-26'
slug: []
output:
  blogdown::html_page:
    highlight: tango
    toc: true
categories:
  - Project
thumbnail: "images/grocery.jpeg"
tags:
  - python
  - customer analysis
  - prediction
Description: ''
Tags: []
Categories: []
DisableComments: no
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#eda">EDA</a></li>
<li><a href="#method">Method</a></li>
<li><a href="#insights">Insights</a>
<ul>
<li><a href="#artifact">Artifact</a></li>
</ul></li>
</ul>
</div>

<p>[üöß Under Construction üöß]</p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Instacart is an internet company that operates same-day grocery delivery service. In this project, we explored ways to predict whether an Instacart user would reorder a certain product in his or her next order, which can be used to implement highly personalized marketing strategies. After consolidating and exploring the Instacart datasets, we identified three feature categories, namely user-behavior-based, product-based and user-product-cross-based features. Having processed all available data, we finally decided on using the XGBoost algorithm as the primary model as it yielded the best accuracy of 75%.</p>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>The dataset we used for this project includes 3 million of Instacart‚Äôs anonymized customer orders from 200,000 Instacart users (4 - 100 orders for each user). Specifically, ‚Äúorder.csv‚Äù specifies all order ids of all customers as well as the time at the order and the time since a customer‚Äôs last order. ‚ÄúOrder_products_prior.csv‚Äù expands each order id that is not the last order of a customer, including in every row the product‚Äôs name and sequence he/she puts it in a cart. ‚ÄúOrder_products_train.csv‚Äù expands all the last order ids of customers, which we turned into labels used for prediction.</p>
<p><img src="instacart_data_shape.png" /></p>
</div>
<div id="eda" class="section level2">
<h2>EDA</h2>
<p>While we cleaned the data, we also visualized some features and discovered a few interesting observations. The upper plot shows the distribution of orders by days since a prior order. Note that day 7 and day 30+ have extremely high number of orders, suggesting that a user have a higher probability to place an order if he or she hasn‚Äôt done so for the past 7 or 30+ days (weekly and monthly basis, respectively). The lower plot shows the distribution of orders among departments. Here we see that products under the ‚Äúproduce‚Äù department have a higher probability to be purchased.</p>
<p><img src="instacart_prior_order.png" /></p>
<p><img src="instacart_order_by_dept.png" /></p>
</div>
<div id="method" class="section level2">
<h2>Method</h2>
<p>For this project we used XGBoost (Extreme Gradient Boosting) model. Gradient boosting tree is an ensemble learning algorithm that iteratively learn weak classifiers and add them to a final strong classifier to produce final predictions. In each round we learned a new tree to approximate the negative gradient and minimize the losses. The parameters we used for the XGBoost included: ‚Äúmin_child_weight‚Äù is the minimum weight that a node can have; ‚Äúgamma‚Äù is the tree size penalty; ‚Äúsubsample‚Äù indicates bagging (sampling with replacement a proportion of the training set) to reduce the level of overfitting; ‚Äúcolsample_bytree‚Äù allows us to perform bagging on a proportion of features to construct the trees, which also helps to reduce overfitting; ‚Äúmax_depth‚Äù is the maximum depth of the tree. The disadvantages of XGBoost are that it is not good at extrapolating unseen values. Therefore if a user nevers bought a product before, our model would never predict it in that user‚Äôs reorder basket. Moreover, we split the data into training set and testing set and also did cross-validation to prevent overfitting.</p>
</div>
<div id="insights" class="section level2">
<h2>Insights</h2>
<p>The AUROC score for our model using XGBoost is 83%. We also analyzed the feature importance to figure out which features contribute the most to the prediction and explain the most variance in our labels. It turned out that the most important feature was <strong>the number of orders since the previous order</strong>. This feature is a user-product-cross-based feature which was generated by us. Intuitively, it is correct to think that a customer is more likely to buy a product if he has bought it just recently. The second and third important feature are <strong>the reorder rate of a product and the total number of different product the customer has bought before</strong>.</p>
<p><img src="instacart_auc.png" /></p>
<div id="artifact" class="section level3">
<h3>Artifact</h3>
<ul>
<li><a href="https://github.com/hnguyen1174/instacart-market-basket-analysis">Github</a></li>
</ul>
</div>
</div>
